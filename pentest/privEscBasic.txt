
Priv Escalation, metodology and order
(eskalacja uprawnien, metodyka i kolejnosc dzialania):


I.  Manual

1) check user:

whoami (windows i linux):
	C:\Users\student>whoami

id:
	student@debian:~$ id


net user (windows):
	C:\Users\student>net user
	C:\Users\student>net user student
	
files (linux):
	cat /etc/passwd
		student@debian:~$ cat /etc/passwd

-----------------------------------------------------------------------	
2) host name - give clues (np : db - database)
hostname (windows i linux)
	C:\Users\student>hostname
	student@debian:~$ hostname
	
-----------------------------------------------------------------------	
3) operating system , veresion , architecture:
systeminfo (windows)
	C:\Users\student>systeminfo | findstr /B /C:"OS Name" /C:"OS Version" /C:"System Type"
	

/etc/issue (linux):
	student@debian:~$ cat /etc/issue

/etc/*-release (linux):	
	student@debian:~$ cat /etc/*-release
	
uname (linux): 
	student@debian:~$ uname -a
	
	
-----------------------------------------------------------------------		
4) Process i services

tasklist (windows):
	C:\Users\student>tasklist /SVC	
	
	
ps aux (linux):		
	student@debian:~$ ps axu	
	
	
-----------------------------------------------------------------------		
5) network informations
	
ipconfig (windows):
	C:\Users\student>ipconfig /all	
	
	
routing tables/route (windows): 	
	C:\Users\student>route print

neststat - establshed connections (windows):	
	C:\Users\student>netstat -ano
	

ifconfig/ip (linux):	
	student@debian:~$ ip a	
	
route (linux):	
	student@debian:~$ /sbin/route	
	
ss active connection:	
	student@debian:~$ ss -anp


-----------------------------------------------------------------------			
6) enumerate firewalls and rules

netsh (windows):
	C:\Users\student>netsh advfirewall show currentprofile


all rules (windows):
	C:\Users\student>netsh advfirewall firewall show rule name=al


-----------------------------------------------------------------------			
7) Enumerating Scheduled Tasks

Scheduled (windows):
	c:\Users\student>schtasks /query /fo LIST /v

cron (linux) :
	student@debian:~$ ls -lah /etc/cron*

	student@debian:~$ cat /etc/crontab

-----------------------------------------------------------------------			
8) Enumerating Installed Applications and Patch Levels

check pach levels from windows installer (windows):
	c:\Users\student>wmic product get name, version, vendor


dpkg , check aplications:
	student@debian:~$ dpkg -l
	
	
	
-----------------------------------------------------------------------			
9) Enumerating Readable/Writable Files and Directories


tool to check permisions of file (windows):
	c:\Tools\privilege_escalation\SysinternalsSuite>accesschk.exe -uws "Everyone" "C:\Program Files"


tool to check permisions of file but in powershell without tool (windows):
	C:\Tools\privilege_escalation\SysinternalsSuite>powershell
	PS C:\Tools\privilege_escalation\SysinternalsSuite>Get-ChildItem "C:\Program Files" -Recurse | Get-ACL | ?{$_.AccessToString -match "Everyone\sAllow\s\sModify"}


find (linux):
	student@debian:~$ find / -writable -type d 2>/dev/null



-----------------------------------------------------------------------			
10)  Enumerating Unmounted Disks

mountvol (windows):
	c:\Users\student>mountvol

mount (linux):
	student@debian:~$ mount


file with all drives mounted with boot time: 	
	student@debian:~$ cat /etc/fstab


-----------------------------------------------------------------------			
11) Enumerating Device Drivers and Kernel Modules


Enumerating Device Drivers (windows):
	c:\Users\student>powershell
	PS C:\Users\student> driverquery.exe /v /fo csv | ConvertFrom-CSV | Select-Object ‘Display Name’, ‘Start Mode’, Path

Enumerating Device Drivers with version (windows):
	c:\Users\student>powershell
	PS C:\Users\student> Get-WmiObject Win32_PnPSignedDriver | Select-Object DeviceName, DriverVersion, Manufacturer | Where-Object {$_.DeviceName -like "*VMware*"}


Enumerating kernel modules (linux):
lsmode (linux):
	student@debian:~$ lsmod

/sbin/modinfo (linux):
	student@debian:~$ /sbin/modinfo libata




-----------------------------------------------------------------------			
12)  Enumerating Binaries That AutoElevate

if autoelevate is ON any user can run windows installer packages with elevaed privilges (windows):
	c:\Users\student>reg query HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer
		HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer
		AlwaysInstallElevated 	REG_DWORD 0x1
	c:\Users\student>reg query HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\Installer
		HKEY_LOCAL_MACHINE\Software\Policies\Microsoft



Linux ha suid files (linux):
	student@debian:~$ find / -perm -u=s -type f 2>/dev/null



-----------------------------------------------------------------------			
-----------------------------------------------------------------------			
II.  Automated Enumeration

1) scrits to automate privilige enumeration

Windows:
	c:\Tools\privilege_escalation\windows-privesc-check-master>windows-privesc-check2.exe -h
	c:\Tools\privilege_escalation\windows-privesc-check-master>windows-privesc-check2.exe --dump -G



Linux:
	student@debian:~$./unix-privesc-check
	
	student@debian:~$ ./unix-privesc-check standard > output.txt	
	
	
	
